<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zikir Takip</title>
    <link rel="manifest" href="./manifest.json?v=2.8">
    <meta name="theme-color" content="#2e7d32">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --ana-renk: #2e7d32;
            --arkaplan: #f0f2f5;
            --kart-bg: #ffffff;
            --radius: 12px;
            --golge: 0 2px 5px rgba(0,0,0,0.1);
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--arkaplan); margin: 0; padding-bottom: 80px; user-select: none; }
        .container { max-width: 600px; margin: 0 auto; padding: 10px; }
        
        /* Header */
        .header {
            background: var(--ana-renk);
            color: white;
            padding: 20px;
            text-align: center; /* Ä°Ã§indeki her ÅŸeyi (resim ve yazÄ±) ortalar */
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .header h1 {
            margin: 8px 0 0 0; /* Logo ile yazÄ± arasÄ±na biraz boÅŸluk */font-size: 1.8rem;}

        .header-logo {
            width: 100px;            /* BÃ¼yÃ¼k ve doyurucu boyut */
            height: 100px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.2);
            background-color: white;
            margin-bottom: 5px;     /* AltÄ±ndaki yazÄ±ya yapÄ±ÅŸmasÄ±n */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            vertical-align: middle;
        }
        /* Kartlar */
        .kart { background: var(--kart-bg); border-radius: var(--radius); padding: 15px; margin-bottom: 15px; box-shadow: var(--golge); animation: fadeIn 0.5s; }
        .kart-baslik { font-weight: bold; color: var(--ana-renk); border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Form ElemanlarÄ± */
        .btn { border: none; padding: 10px 15px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem; transition: 0.2s; }
        .btn-ana { background: var(--ana-renk); color: white; }
        .btn-ana:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--ana-renk); color: var(--ana-renk); }
        .btn-danger { background: #d32f2f; color: white; }
        
        .input-grup { display: flex; gap: 10px; margin-top: 10px; }
        input[type="number"], input[type="date"], input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--ana-renk); }

        /* Alt Navigasyon */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { text-align: center; color: #888; background: none; border: none; font-size: 0.8rem; cursor: pointer; }
        .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 3px; }
        .nav-item.aktif { color: #9a6b2a; }

        /* Sekmeler */
        .tab-content { display: none; }
        .tab-content.aktif { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ã–zel BileÅŸenler */
        .badge { background: #e8f5e9; color: var(--ana-renk); padding: 4px 8px; border-radius: 10px; font-size: 0.8rem; }
        .progress-bg { background: #eee; height: 10px; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .progress-fill { background: var(--ana-renk); height: 100%; width: 0%; transition: width 0.5s; }
        .gecmis-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.9rem; }
        .ayar-btn { text-align: left; margin-bottom: 10px; background: #f9f9f9; color: #333; display: flex; align-items: center; gap: 10px; }

        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-box { background: white; width: 90%; max-width: 400px; padding: 20px; border-radius: 15px; }
        .checkbox-label { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid #f0f0f0; }
	/* --- HARÄ°TA KARTI STÄ°LLERÄ° --- */
        .harita-kapsayici {
            position: relative; /* Linkin Ã¼zerine oturmasÄ± iÃ§in gerekli */
            width: 100%;
            height: 200px;      /* Harita yÃ¼ksekliÄŸi */
            border-radius: 8px;
            overflow: hidden;   /* KÃ¶ÅŸeleri yuvarlat */
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        
        .harita-kapsayici iframe {width: 100%;height: 100%;border: 0;}

        /* HaritanÄ±n Ã¼zerine gelen ÅŸeffaf tÄ±klama alanÄ± */
        .harita-tiklama-alani {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* HaritanÄ±n (iframe) Ã¼stÃ¼nde durur */
            background-color: transparent; 
        }
        .adres-metni {
            font-size: 0.9rem;
            color: #555;
            text-align: center;
            margin-bottom: 10px;
            line-height: 1.4;
        }
		/* --- GÃœNCELLEME UYARI KUTUSU (TOAST) --- */
#update-notification {
    visibility: hidden;
    min-width: 250px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 16px;
    position: fixed;
    z-index: 3000;
    left: 50%;
    bottom: 80px; /* Navigasyonun Ã¼stÃ¼nde dursun */
    transform: translateX(-50%);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#update-notification.show {
    visibility: visible;
    animation: fadein 0.5s, fadeout 0.5s 60s; /* 60sn sonra kaybolur */
}

.update-actions {
    display: flex;
    justify-content: center;
    gap: 10px;
}

.btn-update {
    background: #4caf50;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}
.btn-close {
    background: transparent;
    border: 1px solid #777;
    color: #ddd;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}
		/* --- ARÅÄ°V VE LÄ°STE STÄ°LLERÄ° --- */
.arsiv-toggle-btn {
    background-color: #f1f3f4;
    color: #333;
    padding: 12px 15px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    border: 1px solid #ddd;
    transition: background 0.2s;
}
.arsiv-toggle-btn:active { background-color: #e0e0e0; }

.arsiv-konteyner {
    display: none; /* BaÅŸlangÄ±Ã§ta gizli */
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 10px;
    margin-top: 5px;
}
.arsiv-baslik {
    font-size: 0.9rem;
    font-weight: bold;
    color: #2e7d32; /* Ana renk */
    margin-top: 10px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}
.arsiv-sayfa-kutusu {
    display: inline-block;
    background: #fff;
    border: 1px solid #ccc;
    color: #333;
    padding: 6px 12px;
    margin: 5px 5px 0 0;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
}
.tarih-etiketi {
    font-size: 0.75rem;
    color: #999;
    margin-top: 2px;
}
/* Modal Arka PlanÄ± (Karartma) */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5); /* YarÄ± saydam siyah */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000; /* En Ã¼stte durmasÄ± iÃ§in */
    backdrop-filter: blur(3px); /* Arkadaki sayfayÄ± hafif bulanÄ±klaÅŸtÄ±rÄ±r */
}

/* Pencerenin Kendisi */
.modal-kutu {
    background: white;
    padding: 25px;
    border-radius: 15px;
    width: 85%;
    max-width: 320px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* BaÅŸlÄ±k ve Metin */
.modal-kutu h3 {
    margin: 10px 0;
    color: #333;
    font-size: 1.2rem;
}
.modal-kutu p {
    color: #666;
    font-size: 0.95rem;
    margin-bottom: 20px;
    line-height: 1.5;
}

/* Ä°kon (Opsiyonel) */
.modal-ikon {
    font-size: 2rem;
    margin-bottom: 5px;
}

/* Buton */
.modal-btn {
    background: #2e7d32; /* Sizin yeÅŸil tonunuz */
    color: white;
    border: none;
    padding: 10px 30px;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    transition: background 0.2s;
}
.modal-btn:active {
    background: #1b5e20;
    transform: scale(0.98);
}

/* AÃ§Ä±lma Animasyonu */
@keyframes popUp {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
#inp-sayfa-adet:focus {
    border-color: #2e7d32 !important;
    box-shadow: 0 0 5px rgba(46, 125, 50, 0.5);
}
    </style>
</head>
<body>

    <div class="header">
        <img src="./icon-192.png" class="header-logo"> <h1>Zikir Takip</h1>
    </div>

    <div class="container">
        <div id="tab-hatim" class="tab-content">
			<div class="kart" style="text-align:center; cursor:pointer;" onclick="window.location.href='kuran.html'">
    <div style="font-size:1.5rem; color:#2e7d32; margin-bottom:5px;">
        <i class="fa-solid fa-book-quran"></i>
    </div>
    <div style="font-weight:bold; color:#333;">Kur'an-Ä± Kerim Oku</div>
    <div style="font-size:0.8rem; color:#888;">Serbest okuma yapmak iÃ§in tÄ±kla</div>
</div>
            <div class="kart" style="background:#e3f2fd; border-left:5px solid #1565c0;">
                <div class="kart-baslik" style="color:#1565c0;">
                    <span><i class="fa fa-globe"></i> Online Ortak Hatim</span>
                    <span class="badge" id="online-hatim-no">...</span>
                </div>
                
                <div style="text-align:center; padding:15px;">
                    <div style="font-size:0.9rem; color:#666;">Son AlÄ±nan Sayfa</div>
                    <div style="font-size:3rem; font-weight:bold; color:#1565c0;" id="online-son-sayfa">0</div>
                    <button class="btn btn-ana" style="background:#1565c0; margin-top:10px;" onclick="onlineSayfaAl()">
                        <i class="fa fa-plus"></i> Sayfa Al (SÄ±radaki)
                    </button>
                </div>
            </div>

            <div id="online-alinanlar-listesi">
                </div>
			<div id="arsiv-toggle" class="arsiv-toggle-btn" onclick="arsivAcKapat()">
    <span><i class="fa fa-history" style="color:#777"></i> GeÃ§miÅŸ ArÅŸivi</span>
    <i class="fa fa-chevron-down" id="arsiv-ok-ikonu"></i>
</div>

<div id="arsiv-alani" class="arsiv-konteyner">
    <div style="text-align:center; color:#999; font-size:0.8rem; padding:10px;">ArÅŸiv boÅŸ.</div>
</div>
        </div>
        <div id="tab-zikir" class="tab-content aktif">
            <div style="text-align:right; margin-bottom:10px;">
                <button class="btn btn-outline" style="width:auto; padding:6px 15px; font-size:0.9rem;" onclick="toggleZikirModal()">
                    <i class="fa fa-plus"></i> Ders Ekle / Ã‡Ä±kar
                </button>
            </div>
            
            <div id="zikir-container"></div>
        </div>

       <div id="tab-ayarlar" class="tab-content">
    
    <div class="kart">
        <div class="kart-baslik">Veri Yedekleme</div>
        <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">Verileriniz sadece telefonunuzda saklanÄ±r. Silinmemesi iÃ§in dÃ¼zenli yedek alÄ±nÄ±z.</p>
        
        <button class="btn ayar-btn" onclick="yedekIndir()">
            <i class="fa fa-download"></i> YedeÄŸi Ä°ndir (Dosya)
        </button>
        
        <button class="btn ayar-btn" onclick="document.getElementById('yedek-yukle').click()">
            <i class="fa fa-upload"></i> YedeÄŸi Geri YÃ¼kle
        </button>
        <input type="file" id="yedek-yukle" style="display:none" onchange="yedekYukle(this)">
        
        <button class="btn ayar-btn btn-danger" style="margin-top:20px; color:white; background:#d32f2f;" onclick="sifirla()">
            <i class="fa fa-trash"></i> TÃ¼m Verileri Sil
        </button>
    </div>
    <div class="kart">
    <div class="kart-baslik">
        <span><i class="fa fa-question-circle"></i> SÄ±kÃ§a Sorulan Sorular & YardÄ±m</span>
    </div>
    
    <details style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
        <summary style="cursor:pointer; font-weight:600; color:#444; outline:none; display:flex; align-items:center; gap:8px;">
            <i class="fa fa-download" style="color:#2e7d32; font-size:1rem;"></i> UygulamayÄ± telefonuma nasÄ±l yÃ¼klerim?
        </summary>
        <div style="font-size:0.9rem; color:#555; margin-top:10px; line-height:1.6; padding-left:5px;">
            Bu uygulamayÄ± maÄŸazada aramanÄ±za gerek yoktur. Åu adÄ±mlarÄ± izleyin:
            
            <div style="margin-top:10px; background:#f9f9f9; padding:10px; border-radius:6px; border-left:4px solid #2e7d32;">
                <strong> Android Ä°Ã§in:</strong>
                <ol style="margin:5px 0; padding-left:20px;">
                    <li>Linki <b>Chrome</b> tarayÄ±cÄ±sÄ± ile aÃ§Ä±n.</li>
                    <li>SaÄŸ Ã¼stteki <b>3 noktaya (â‹®)</b> tÄ±klayÄ±n.</li>
                    <li>Listeden <b>"UygulamayÄ± YÃ¼kle"</b> veya <b>"Ana Ekrana Ekle"</b> seÃ§eneÄŸine basÄ±n.</li>
                </ol>
            </div>

            <div style="margin-top:10px; background:#f9f9f9; padding:10px; border-radius:6px; border-left:4px solid #333;">
                <strong> iPhone (iOS) Ä°Ã§in:</strong>
                <ol style="margin:5px 0; padding-left:20px;">
                    <li>Linki <b>Safari</b> tarayÄ±cÄ±sÄ± ile aÃ§Ä±n.</li>
                    <li>EkranÄ±n altÄ±ndaki <b>"PaylaÅŸ"</b> (kare ve yukarÄ± ok) butonuna basÄ±n.</li>
                    <li>MenÃ¼yÃ¼ yukarÄ± kaydÄ±rÄ±p <b>"Ana Ekrana Ekle"</b> seÃ§eneÄŸine basÄ±n.</li>
                </ol>
            </div>
        </div>
    </details>

    <details style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
        <summary style="cursor:pointer; font-weight:600; color:#444; outline:none; display:flex; align-items:center; gap:8px;">
            <i class="fa fa-sync" style="color:#1976d2; font-size:1rem;"></i> GÃ¼ncellemeleri alamÄ±yorum, ne yapmalÄ±yÄ±m?
        </summary>
        <div style="font-size:0.9rem; color:#555; margin-top:10px; line-height:1.6; padding-left:5px;">
            Telefonunuz internet kotanÄ±zÄ± korumak iÃ§in uygulamanÄ±n eski halini hafÄ±zada tutuyor olabilir. SÄ±rasÄ±yla ÅŸunlarÄ± deneyin:
            <br><br>
            <strong>Ã‡Ã¶zÃ¼m 1 (Ã–nerilen):</strong><br>
            YukarÄ±daki mavi renkli <b>"GÃ¼ncellemeleri Denetle"</b> butonuna basÄ±n ve sayfanÄ±n yenilenmesini bekleyin.
            <br><br>
            <strong>Ã‡Ã¶zÃ¼m 2 (Kesin Ã‡Ã¶zÃ¼m):</strong><br>
            EÄŸer dÃ¼zelmezse uygulamayÄ± silip tekrar kurmanÄ±z gerekir.
            <div style="background:#ffebee; padding:10px; border-radius:6px; margin-top:5px; border:1px solid #ffcdd2;">
                <strong style="color:#d32f2f;">âš ï¸ DÄ°KKAT: Veri KaybÄ± Riski</strong><br>
                UygulamayÄ± silmeden Ã¶nce mutlaka yukarÄ±daki <b>"YedeÄŸi Ä°ndir"</b> butonuyla verilerinizi yedekleyin. Aksi takdirde zikir kayÄ±tlarÄ±nÄ±z silinebilir.
            </div>
            <ol style="margin:5px 0; padding-left:20px;">
                <li>YedeÄŸinizi aldÄ±ÄŸÄ±nÄ±zdan emin olun.</li>
                <li>Ana ekrandaki "Zikir Takip" simgesini tamamen kaldÄ±rÄ±n (Silin).</li>
                <li>Linki tekrar aÃ§Ä±p kurulum adÄ±mlarÄ±nÄ± ("Ana Ekrana Ekle") baÅŸtan uygulayÄ±n.</li>
                <li>Son olarak "YedeÄŸi Geri YÃ¼kle" diyerek verilerinizi geri getirin.</li>
            </ol>
        </div>
    </details>

    <details style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
        <summary style="cursor:pointer; font-weight:600; color:#444; outline:none; display:flex; align-items:center; gap:8px;">
            <i class="fa fa-wifi" style="color:#f57c00; font-size:0.9rem;"></i> Ä°nternetim yokken Ã§alÄ±ÅŸÄ±r mÄ±?
        </summary>
        <p style="font-size:0.9rem; color:#666; margin-top:5px; line-height:1.5;">
            Evet. Zikir sayaÃ§larÄ±, geÃ§miÅŸ kayÄ±tlarÄ±nÄ±z ve "Kur'an Oku" Ã¶zelliÄŸi internet olmadan da Ã§alÄ±ÅŸÄ±r. Sadece "Online Ortak Hatim"den <b>yeni sayfa almak</b> iÃ§in internet gereklidir.
        </p>
    </details>

    <details style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
        <summary style="cursor:pointer; font-weight:600; color:#444; outline:none; display:flex; align-items:center; gap:8px;">
            <i class="fa fa-shield-alt" style="color:#555; font-size:0.9rem;"></i> Verilerim silinir mi?
        </summary>
        <p style="font-size:0.9rem; color:#666; margin-top:5px; line-height:1.5;">
            Verileriniz sunucuda deÄŸil, sadece <b>sizin telefonunuzda</b> saklanÄ±r. EÄŸer telefonunuzu sÄ±fÄ±rlarsanÄ±z veya tarayÄ±cÄ± geÃ§miÅŸini temizlerseniz veriler gidebilir.
            <br><br>
            Bu yÃ¼zden yukarÄ±daki <b>"YedeÄŸi Ä°ndir"</b> butonu ile ara sÄ±ra yedeÄŸinizi almanÄ±z Ã¶nerilir.
        </p>
    </details>

    <details style="margin-bottom:5px;">
        <summary style="cursor:pointer; font-weight:600; color:#444; outline:none; display:flex; align-items:center; gap:8px;">
            <i class="fa-solid fa-book-quran" style="color:#2e7d32; font-size:0.9rem;"></i> Hatim sayfasÄ± nasÄ±l alÄ±rÄ±m?
        </summary>
        <div style="font-size:0.9rem; color:#666; margin-top:5px; line-height:1.6;">
            Hatim sekmesine girip mavi renkli <b>"Sayfa Al"</b> butonuna basÄ±nÄ±z.
            <br><br>
            <i class="fa fa-check-circle" style="color:#2e7d32"></i> <b>Toplu Sayfa Alma:</b> GirdiÄŸiniz sayÄ± kadar sayfayÄ± tek seferde alabilirsiniz. Ã–rneÄŸin "5" yazarsanÄ±z, sistem sÄ±radaki boÅŸ 5 sayfayÄ± (Ã–rn: 21'den 25'e kadar) size tanÄ±mlar.
            <br><br>
            AldÄ±ÄŸÄ±nÄ±z sayfayÄ± okuduktan sonra sistemden dÃ¼ÅŸmenize gerek yoktur. Sistem o sayfayÄ± size verdiÄŸi an "Okunacak" olarak kaydeder ve baÅŸkasÄ±na vermez.
        </div>
    </details>
</div>
    <div class="kart" style="text-align:center;">
        <p>Mevcut SÃ¼rÃ¼m: <strong id="uygulama-versiyon">v2.0</strong></p>
        
        <button onclick="guncellemeKontrol()" class="btn btn-primary" style="background-color: #2196F3; color: white;">
            <i class="fa fa-sync"></i> GÃ¼ncellemeleri Denetle ve YÃ¼kle
        </button>
    </div>

    <div class="kart">
        <div class="kart-baslik">
            <span><i class="fa fa-map-marker-alt"></i> Buhara VakfÄ± AkyazÄ± Åubesi</span>
        </div>
        
        <p class="adres-metni">
           Fatih mh. 9024 sk. 10/A <br>
            AkyazÄ± / Sakarya
        </p>

       <div class="harita-kapsayici">
    <iframe 
        width="100%" 
        height="100%" 
        frameborder="0" 
        scrolling="no" 
        marginheight="0" 
        marginwidth="0" 
        src="https://maps.google.com/maps?q=Buhara+Vakf%C4%B1+Akyaz%C4%B1&t=&z=17&ie=UTF8&iwloc=B&output=embed">
    </iframe>
</div>

<a href="https://www.google.com/maps/dir//Buhara+VakfÄ±+AkyazÄ±" target="_blank" class="btn btn-outline" style="text-decoration:none; display:block; text-align:center; margin: 10px auto 0 auto; width: auto;">
    <i class="fa fa-directions"></i> Yol Tarifi Al
</a>
    </div>

</div>

    <div class="bottom-nav">
        <button class="nav-item aktif" onclick="navGit('zikir', this)">
            <i class="fa fa-fingerprint"></i> Zikirlerim
        </button>
		<button class="nav-item" onclick="navGit('hatim', this)">
            <i class="fa-solid fa-book-quran"></i> Hatim
        </button>
        <button class="nav-item" onclick="navGit('ayarlar', this)">
            <i class="fa fa-cog"></i> Ayarlar
        </button>
    </div>

    <div id="modal-zikir" class="modal">
        <div class="modal-box">
            <h3 style="margin-top:0; color:var(--ana-renk);">Ders SeÃ§imi</h3>
            <p style="font-size:0.9rem; color:#666;">Ana ekranda gÃ¶rmek istediklerinizi iÅŸaretleyin.</p>
            <div style="display:flex; flex-direction:column; margin:15px 0; max-height:300px; overflow-y:auto;">
                <label class="checkbox-label"><input type="checkbox" id="chk-kalp"> Kalp Zikri</label>
                <label class="checkbox-label"><input type="checkbox" id="chk-letaif"> Letaif Dersleri</label>
                <label class="checkbox-label"><input type="checkbox" id="chk-nefyu"> Nefyu Ä°sbat</label>
                <label class="checkbox-label"><input type="checkbox" id="chk-tehlil"> Hatme-i Tehlil</label>
                <label class="checkbox-label"><input type="checkbox" id="chk-ihlas"> Ä°hlas-Ä± Åerif</label>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-outline" onclick="toggleZikirModal()">Ä°ptal</button>
                <button class="btn btn-ana" onclick="zikirSecimKaydet()">Kaydet</button>
            </div>
        </div>
    </div>
<div id="modal-hatim-uyari" class="modal">
    <div class="modal-box" style="text-align:center;">
        <div style="font-size:3rem; color:#f57c00; margin-bottom:10px;">
            <i class="fa fa-exclamation-triangle"></i>
        </div>
        <h3 style="margin-top:0; color:#333;">Ã–nemli HatÄ±rlatma</h3>
        
        <p style="font-size:0.95rem; color:#555; line-height:1.6; text-align:left;">
            AlÄ±nan sayfalarÄ± okuyacaÄŸÄ±nÄ±z Ã¶ngÃ¶rÃ¼lerek kalan sayfalar diÄŸer kiÅŸilere daÄŸÄ±tÄ±lÄ±r.
            <br><br>
            <span style="color:#d32f2f; font-weight:bold; font-size:1rem;">
                AldÄ±ÄŸÄ±nÄ±z sayfanÄ±n okunmasÄ± sizin sorumluluÄŸunuzdadÄ±r.
            </span>
            <br><br>
            Hatmin dÃ¼zgÃ¼n tamamlanabilmesi iÃ§in lÃ¼tfen aldÄ±ÄŸÄ±nÄ±z sayfalarÄ± okuyunuz.
        </p>

        <div style="margin:20px 0; padding:10px; background:#f9f9f9; border-radius:8px; text-align:left;">
            <label style="display:flex; align-items:center; cursor:pointer;">
                <input type="checkbox" id="chk-hatim-uyari-kalici" style="width:20px; height:20px; margin-right:10px;">
                <span style="font-size:0.9rem; color:#666;">Bu uyarÄ±yÄ± bir daha gÃ¶sterme</span>
            </label>
        </div>

        <button class="btn btn-ana" onclick="kapatHatimUyari()">AnladÄ±m, OkuyacaÄŸÄ±m</button>
    </div>
</div>
		<div id="update-notification">
    <div>
        <i class="fa fa-sync fa-spin"></i> Yeni bir gÃ¼ncelleme mevcut!
    </div>
    <div class="update-actions">
        <button class="btn-close" onclick="closeUpdateModal()">Sonra</button>
        <button class="btn-update" onclick="guncellemeKontrol()">YÃ¼kle</button>
    </div>
</div>
<script>
// --- VERÄ° YAPISI ---
const APP_VERSION = "v2.8"; // pop up msj
const API_URL = "https://script.google.com/macros/s/AKfycbyjgcqxphx1289d7I6huxpj-ImqUbOscgg5pM6waojHhU-r9NoQnJ_4DpPmgw9WtOYJ/exec";
const DB_KEY = "ZikirTakipData_v2";
let data = {
    aktifler: [], // ["kalp", "letaif"] gibi
    kalp: { baslangic: "" },
    letaif: { baslangic: "", hedef: 23000, tur: "" },
    nefyu: { baslangic: "", sayi: 0 },
    tehlil: { baslangic: "", toplam: 0, biten: 0, gecmis: [] },
    ihlas: { baslangic: "", toplam: 0, biten: 0, gecmis: [] }
};
// Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda versiyonu ekrana bas
document.addEventListener("DOMContentLoaded", function() {
    let verSpan = document.getElementById("uygulama-versiyon");
    if(verSpan) verSpan.innerText = APP_VERSION;
});

// GÃœNCELLEME FONKSÄ°YONU (ZORLA YENÄ°LEME)
function guncellemeKontrol() {
    if(!confirm("UygulamanÄ±n en gÃ¼ncel halini yÃ¼klemek iÃ§in sayfa yenilenecek. OnaylÄ±yor musunuz?")) return;

    showLoader(true); // YÃ¼kleniyor animasyonu varsa aÃ§

    if ('serviceWorker' in navigator) {
        // TÃ¼m kayÄ±tlÄ± Service Worker'larÄ± bul
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            // Hepsini tek tek sil (Unregister)
            for(let registration of registrations) {
                registration.unregister();
            }
            // Ã–nbelleÄŸi temizle ve sayfayÄ± sunucudan zorla yeniden yÃ¼kle
            window.location.reload(true);
        }).catch(function(err) {
            console.log('Service Worker silinemedi:', err);
            window.location.reload(true); // Hata olsa bile yenile
        });
    } else {
        // Service worker yoksa direkt yenile
        window.location.reload(true);
    }
}
// --- BAÅLANGIÃ‡ VE SW KONTROLÃœ ---
window.onload = function() {
    // 1. VeritabanÄ±nÄ± yÃ¼kle
    let stored = localStorage.getItem(DB_KEY);
    if(stored) data = JSON.parse(stored);
        // Ä°lk aÃ§Ä±lÄ±ÅŸ kontrolÃ¼
    if(data.aktifler.length === 0) toggleZikirModal();
    arayuzGuncelle();
    // 2. Service Worker KaydÄ± ve GÃ¼ncelleme Dinleyicisi
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(function(reg) {
            
            // EÄŸer servis Ã§alÄ±ÅŸanÄ± zaten varsa ve yenisi bekliyorsa
            if (reg.waiting) {
                showUpdateBar();
                return;
            }
            // Yeni bir gÃ¼ncelleme bulunduÄŸunda
            reg.onupdatefound = function() {
                let installingWorker = reg.installing;
                
                installingWorker.onstatechange = function() {
                    if (installingWorker.state === 'installed') {
                        if (navigator.serviceWorker.controller) {
                            // Zaten eski bir versiyon kontrol ediyorsa ve yenisi geldiyse:
                            console.log("Yeni gÃ¼ncelleme hazÄ±r.");
                            showUpdateBar();
                        } else {
                            console.log("Ä°Ã§erik Ã¶nbelleÄŸe alÄ±ndÄ±, Ã§evrimdÄ±ÅŸÄ± kullanÄ±labilir.");
                        }
                    }
                };
            };
        }).catch(function(err) {
            console.error('SW kaydÄ± baÅŸarÄ±sÄ±z:', err);
        });
    }
};

// UyarÄ± kutusunu gÃ¶steren fonksiyon
function showUpdateBar() {
    let x = document.getElementById("update-notification");
    x.className = "show";
}

// UyarÄ± kutusunu kapatan fonksiyon
function closeUpdateModal() {
    let x = document.getElementById("update-notification");
    x.className = x.className.replace("show", "");
}

function kaydet() {
    localStorage.setItem(DB_KEY, JSON.stringify(data));
    arayuzGuncelle();
}

function navGit(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('aktif'));
    document.getElementById('tab-' + tabId).classList.add('aktif');
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('aktif'));
    btn.classList.add('aktif');
    // EÄER HATÄ°M SEKMESÄ° AÃ‡ILDIYSA
    if(tabId === 'hatim') {
        onlineHatimYukle();
        hatimUyariKontrol(); // <-- YENÄ° EKLENEN SATIR BU
    }
}

function arayuzGuncelle() {
    renderZikirKartlari();
    // Modal CheckboxlarÄ±nÄ± gÃ¼ncelle
    document.getElementById("chk-kalp").checked = data.aktifler.includes("kalp");
    document.getElementById("chk-letaif").checked = data.aktifler.includes("letaif");
    document.getElementById("chk-nefyu").checked = data.aktifler.includes("nefyu");
    document.getElementById("chk-tehlil").checked = data.aktifler.includes("tehlil");
    document.getElementById("chk-ihlas").checked = data.aktifler.includes("ihlas");
}

// --- ZÄ°KÄ°R FONKSÄ°YONLARI ---
function toggleZikirModal() {
    let m = document.getElementById("modal-zikir");
    m.style.display = (m.style.display == "flex") ? "none" : "flex";
}

function zikirSecimKaydet() {
    let list = [];
    if(document.getElementById("chk-kalp").checked) list.push("kalp");
    if(document.getElementById("chk-letaif").checked) list.push("letaif");
    if(document.getElementById("chk-nefyu").checked) list.push("nefyu");
    if(document.getElementById("chk-tehlil").checked) list.push("tehlil");
    if(document.getElementById("chk-ihlas").checked) list.push("ihlas");
    data.aktifler = list;
    kaydet();
    toggleZikirModal();
}

function renderZikirKartlari() {
    let container = document.getElementById("zikir-container");
    container.innerHTML = "";
    
    if(data.aktifler.length === 0) {
        container.innerHTML = "<p style='text-align:center; color:#888; margin-top:50px;'>Takip listeniz boÅŸ.<br>'+ Zikir Ekle' butonuna basÄ±nÄ±z.</p>";
        return;
    }

    data.aktifler.forEach(tip => {
        if(tip == 'kalp') container.innerHTML += kartKalp();
        if(tip == 'letaif') container.innerHTML += kartLetaif();
        if(tip == 'nefyu') container.innerHTML += kartNefyu();
        if(tip == 'tehlil') container.innerHTML += kartSayacli('Hatme-i Tehlil', 'tehlil', 70000);
        if(tip == 'ihlas') container.innerHTML += kartSayacli('Ä°hlas-Ä± Åerif', 'ihlas', 100000);
    });
}

function gunHesapla(tarih) {
    if(!tarih) return 0;
    let diff = new Date() - new Date(tarih);
    let gun = Math.floor(diff / (1000 * 60 * 60 * 24));
    return gun > 0 ? gun : 0;
}

// --- KART HTML ÃœRETÄ°CÄ°LERÄ° ---

function kartKalp() {
    let d = data.kalp;
    let gun = gunHesapla(d.baslangic);
    return `<div class="kart">
        <div class="kart-baslik">
            <span><i class="fa fa-heart" style="color:#d32f2f"></i> Kalp Zikri</span>
            <span class="badge">${gun} GÃ¼n</span>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <label style="font-size:0.9rem; color:#666;">BaÅŸlangÄ±Ã§:</label>
            <input type="date" style="width:60%; padding:8px;" value="${d.baslangic}" onchange="updateZikir('kalp', 'baslangic', this.value)">
        </div>
    </div>`;
}

function kartLetaif() {
    let d = data.letaif;
    let gun = gunHesapla(d.baslangic);
    
    // Hesaplama
    let s = d.hedef;
    let r1000 = Math.floor(s/6000); s %= 6000;
    let r500 = Math.floor(s/3000); s %= 3000;
    let r100 = Math.floor(s/600); s %= 600;
    let kirik = s;
    
    let hesapText = `<i class="fa fa-check-circle" style="color:var(--ana-renk)"></i> <b>${r1000}</b> Tur 1000'lik (x6)<br>
                     <i class="fa fa-check-circle" style="color:var(--ana-renk)"></i> <b>${r500}</b> Tur 500'lÃ¼k (x6)<br>
                     <i class="fa fa-check-circle" style="color:var(--ana-renk)"></i> <b>${r100}</b> Tur 100'lÃ¼k (x6)`;
    if(kirik > 0) hesapText += `<br><i class="fa fa-plus-circle" style="color:#f57c00"></i> <b>${kirik}</b> adet ilave`;

    return `<div class="kart">
        <div class="kart-baslik">
            <span><i class="fa fa-layer-group"></i> Letaif Dersleri</span>
            <span class="badge">${gun} GÃ¼n</span>
        </div>
        <div style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
             <small>BaÅŸlangÄ±Ã§:</small> <input type="date" style="width:60%; padding:5px;" value="${d.baslangic}" onchange="updateZikir('letaif', 'baslangic', this.value)">
        </div>
        <hr style="border:0; border-top:1px dashed #eee;">
        <div class="input-grup" style="align-items:center;">
            <span style="font-size:0.9rem;">Hedef:</span>
            <input type="number" value="${d.hedef}" step="2000" onchange="updateZikir('letaif', 'hedef', this.value)">
        </div>
        <div style="background:#e8f5e9; padding:10px; margin-top:10px; border-radius:8px; font-size:0.85rem; line-height:1.6;">${hesapText}</div>
        <div class="input-grup" style="margin-top:15px;">
            <input type="text" placeholder="Not (Ã–rn: 2. TurdayÄ±m)" value="${d.tur}" onchange="updateZikir('letaif', 'tur', this.value)">
        </div>
    </div>`;
}

function kartNefyu() {
    let d = data.nefyu;
    let gun = gunHesapla(d.baslangic);
    return `<div class="kart">
        <div class="kart-baslik">
            <span><i class="fa fa-infinity"></i> Nefyu Ä°sbat</span>
            <span class="badge">${gun} GÃ¼n</span>
        </div>
        <div style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
             <small>BaÅŸlangÄ±Ã§:</small> <input type="date" style="width:60%; padding:5px;" value="${d.baslangic}" onchange="updateZikir('nefyu', 'baslangic', this.value)">
        </div>
        <div style="text-align:center; font-size:2.5rem; font-weight:bold; color:var(--ana-renk); margin:10px 0;">
            ${d.sayi} <span style="font-size:1rem; color:#999; font-weight:normal;">/ 21</span>
        </div>
        <div class="input-grup">
            <input type="number" id="nefyu-ekle" placeholder="SayÄ±">
            <button class="btn btn-ana" onclick="nefyuIslem('ilave')">+ Ekle</button>
            <button class="btn btn-outline" onclick="nefyuIslem('yenile')">Yenile</button>
        </div>
    </div>`;
}

function nefyuIslem(tip) {
    let el = document.getElementById("nefyu-ekle");
    let val = parseInt(el.value);
    if(!val && val !== 0) return;
    let mevcut = data.nefyu.sayi || 0;
    
    if(tip == 'ilave') mevcut += val;
    else mevcut = val;
    
    if(mevcut > 21) { ozelAlert("SayÄ± 21'i geÃ§emez!"); return; }
    
    data.nefyu.sayi = mevcut;
    el.value = "";
    kaydet();
}

function kartSayacli(baslik, key, hedef) {
    let d = data[key];
    let yuzde = Math.min(100, Math.floor((d.toplam / hedef) * 100));
    
    let btnTamam = "";
    if(d.toplam >= hedef) {
        btnTamam = `<div style="text-align:center; margin:10px 0;">
            <div style="color:#2e7d32; font-weight:bold; margin-bottom:5px;">ğŸ‰ Tebrikler! Hedef TamamlandÄ±.</div>
            <button class="btn btn-ana" onclick="sayacSifirla('${key}')">Yeni Hatim BaÅŸlat (+1)</button>
        </div>`;
    }

    let gecmisHTML = "";
    if(d.gecmis && d.gecmis.length > 0) {
        d.gecmis.slice(0,5).forEach(g => {
            gecmisHTML += `<div class="gecmis-item"><span>${g.tarih}</span><b>+${g.miktar.toLocaleString()}</b></div>`;
        });
    } else { gecmisHTML = "<div style='color:#999; font-size:0.8rem;'>HenÃ¼z kayÄ±t yok.</div>"; }

    return `<div class="kart">
        <div class="kart-baslik">
            <span><i class="fa fa-chart-pie"></i> ${baslik}</span>
            <span class="badge">Biten: ${d.biten}</span>
        </div>
        
        <div class="progress-bg"><div class="progress-fill" style="width:${yuzde}%"></div></div>
        <div style="text-align:center; font-size:0.9rem; margin-bottom:10px; color:#555;">
             <b>${d.toplam.toLocaleString()}</b> / ${hedef.toLocaleString()} (%${yuzde})
        </div>
        
        ${btnTamam}
        
        <div class="input-grup" style="${d.toplam>=hedef ? 'display:none':''}">
            <input type="number" id="sayac-${key}" placeholder="Okunan Miktar">
            <button class="btn btn-ana" onclick="sayacEkle('${key}')">Kaydet</button>
        </div>

        <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
             <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">Son Hareketler:</div>
             ${gecmisHTML}
        </div>
        
        <div style="margin-top:10px; font-size:0.85rem; color:#666; display:flex; justify-content:space-between; align-items:center;">
             <span>BaÅŸlangÄ±Ã§:</span>
             <input type="date" style="width:60%; padding:5px;" value="${d.baslangic}" onchange="updateZikir('${key}', 'baslangic', this.value)">
        </div>
    </div>`;
}

function sayacEkle(key) {
    let el = document.getElementById("sayac-"+key);
    let val = parseInt(el.value);
    if(!val) return;
    
    data[key].toplam += val;
    // GeÃ§miÅŸe ekle
    if(!data[key].gecmis) data[key].gecmis = [];
    data[key].gecmis.unshift({tarih: new Date().toLocaleDateString("tr-TR"), miktar: val});
    if(data[key].gecmis.length > 10) data[key].gecmis.pop();
    
    el.value = "";
    kaydet();
}

function sayacSifirla(key) {
    if(confirm("SayÄ± sÄ±fÄ±rlanacak ve Biten sayacÄ± +1 artacak. OnaylÄ±yor musunuz?")) {
        data[key].biten++;
        data[key].toplam = 0;
        data[key].gecmis = [];
        data[key].baslangic = new Date().toISOString().substring(0,10);
        kaydet();
    }
}

function updateZikir(anaKey, altKey, val) {
    data[anaKey][altKey] = val;
    kaydet();
}

// --- YEDEKLEME ---
function yedekIndir() {
    let dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
    let a = document.createElement('a');
    a.href = dataStr;
    a.download = "zikir_yedek_" + new Date().toLocaleDateString("tr-TR") + ".json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

function yedekYukle(input) {
    let file = input.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = function(e) {
        try {
            let json = JSON.parse(e.target.result);
            // Basit doÄŸrulama: iÃ§inde 'zikir' veya 'kalp' var mÄ±?
            if(json.kalp && json.letaif) {
                if(confirm("Mevcut veriler silinip yedek yÃ¼klenecek. Emin misiniz?")) {
                    data = json;
                    kaydet();
                    ozelAlert("Yedek baÅŸarÄ±yla yÃ¼klendi.");
                }
            } else {
                ozelAlert("GeÃ§ersiz veya hatalÄ± yedek dosyasÄ±!");
            }
        } catch(err) { ozelAlert("Dosya okunamadÄ±!"); }
    };
    reader.readAsText(file);
}

function sifirla() {
    if(confirm("DÄ°KKAT: TÃ¼m verileriniz kalÄ±cÄ± olarak silinecek!")) {
        localStorage.removeItem(DB_KEY);
        location.reload();
    }
}
// --- ONLINE HATÄ°M FONKSÄ°YONLARI ---
// --- YARDIMCI FONKSÄ°YONLAR ---

function showLoader(goster) {
    let loader = document.getElementById("loader");
    if(loader) loader.style.display = goster ? "flex" : "none";
}

function ekranGoster(id) {
    document.querySelectorAll(".ekran").forEach(e => e.style.display = "none");
    let hedef = document.getElementById(id);
    if(hedef) hedef.style.display = "block";
}
// KullanÄ±cÄ± KimliÄŸi (Cihaza Ã¶zel sabit ID oluÅŸturur)
function getKullaniciID() {
    let id = localStorage.getItem("pwa_user_id");
    if (!id) {
        id = "user_" + Math.floor(Math.random() * 1000000);
        localStorage.setItem("pwa_user_id", id);
    }
    return id;
}

// Hatim Durumunu Ã‡ek
function onlineHatimYukle() {
    // Ä°nternet kontrolÃ¼
    if (!navigator.onLine) {
        document.getElementById("online-son-sayfa").innerText = "Offline";
        return;
    }

    fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: "getDurum" })
    })
    .then(res => res.json())
    .then(data => {
        if(data.status == 'ok') {
            document.getElementById("online-hatim-no").innerText = data.aktifHatim + ". Hatim";
            document.getElementById("online-son-sayfa").innerText = data.sonSayfa;
			otomatikGecmisHatimleriTemizle(data.aktifHatim);
        }
    });
    
    alinanlariListele();
	arsivRenderEt();
}

// Sayfa Alma Ä°steÄŸi
// 1. Butona basÄ±lÄ±nca pencereyi aÃ§an fonksiyon
function onlineSayfaAl() {
    if (!navigator.onLine) {
        ozelAlert("Hatim almak iÃ§in internet gereklidir.", "BaÄŸlantÄ± HatasÄ±");
        return;
    }
    
    // GiriÅŸ kutusunu sÄ±fÄ±rla ve aÃ§
    document.getElementById("inp-sayfa-adet").value = "1";
    document.getElementById("modal-sayfa-al").style.display = "flex";
    
    // KullanÄ±cÄ± direkt yazabilsin diye imleci kutuya odakla
    setTimeout(() => document.getElementById("inp-sayfa-adet").focus(), 100);
}

// 2. Pencereyi kapatan fonksiyon (Ä°ptal iÃ§in)
function kapatSayfaModal() {
    document.getElementById("modal-sayfa-al").style.display = "none";
}

// 3. KullanÄ±cÄ± "Tamam" dediÄŸinde Ã§alÄ±ÅŸan asÄ±l iÅŸlem
function onaylaSayfaAl() {
    // SayÄ±yÄ± al
    let girilenAdet = document.getElementById("inp-sayfa-adet").value;
    let adet = parseInt(girilenAdet);

    // --- KONTROLLER ---
    if (isNaN(adet) || adet < 1) {
        // Hata varsa pencereyi kapatma, sadece uyar
        alert("LÃ¼tfen en az 1 sayfa giriniz."); 
        return;
    }

    if (adet > 20) {
        alert("Tek seferde en fazla 20 sayfa alabilirsiniz.");
        return;
    }

    // Her ÅŸey tamamsa pencereyi kapat ve sunucuya git
    kapatSayfaModal(); 
    sunucudanSayfaIste(adet);
}

// 4. Sunucu Ä°letiÅŸimi (Eski kodun fetch kÄ±smÄ± buraya taÅŸÄ±ndÄ±)
function sunucudanSayfaIste(adet) {
    let mevcutHatimText = document.getElementById("online-hatim-no").innerText; 
    let mevcutHatimNo = parseInt(mevcutHatimText) || 0;

    showLoader(true);

    fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ 
            action: "sayfaAl", 
            kullaniciId: getKullaniciID(),
            adet: adet 
        })
    })
    .then(res => res.json())
    .then(data => {
        showLoader(false);
        if(data.status == 'ok') {
            
            // --- BURASI BAÅARILI OLUNCA Ã‡IKAN MESAJ ---
            // ArtÄ±k alert deÄŸil, Ã¶zel penceremiz Ã§Ä±kacak
            ozelAlert(data.mesaj, "Sayfalar Verildi âœ…");
            
            let localList = JSON.parse(localStorage.getItem("online_sayfalarim") || "[]");
            
            data.sayfalar.reverse().forEach(s => {
                localList.unshift({ 
                    sayfa: s, 
                    tarih: new Date().toLocaleDateString("tr-TR"),
                    hatimNo: mevcutHatimNo 
                });
            });
            
            localStorage.setItem("online_sayfalarim", JSON.stringify(localList));
            onlineHatimYukle(); 
        } else {
            ozelAlert(data.message, "Hata OluÅŸtu");
        }
    })
    .catch(() => { 
        showLoader(false); 
        ozelAlert("BaÄŸlantÄ± hatasÄ±.", "Hata"); 
    });
}
	// Listeyi Ekrana Basma ve OKUMA Butonu
function alinanlariListele() {
    let list = JSON.parse(localStorage.getItem("online_sayfalarim") || "[]");
    let html = "";
    
    if(list.length === 0) {
        document.getElementById("online-alinanlar-listesi").innerHTML = 
            "<div style='text-align:center; color:#999; margin:20px;'>Aktif sayfanÄ±z yok.<br>Sayfa Al butonunu kullanabilirsiniz.</div>";
        return;
    }

    list.forEach((item, index) => {
        // EÄŸer eski verilerde hatimNo yoksa '?' gÃ¶ster
        let hNo = item.hatimNo ? item.hatimNo + ". Hatim" : "";

        html += `<div class="kart" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-size:0.75rem; color:#2e7d32; font-weight:bold;">${hNo}</div>
                        <div style="font-size:1.1rem; font-weight:bold;">Sayfa ${item.sayfa}</div>
                        <div class="tarih-etiketi">${item.tarih}</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn btn-outline" style="width:auto; padding:8px 12px;" onclick="sayfaAc(${item.sayfa})">
                            <i class="fa fa-book-open"></i> Oku
                        </button>
                        <button class="btn" style="background:#eee; color:#555; width:auto; padding:8px 12px;" onclick="manuelArsivle(${index}, '${item.hatimNo || 'Eski'}', ${item.sayfa})">
                            <i class="fa fa-archive"></i>
                        </button>
                    </div>
                 </div>`;
    });
    
    document.getElementById("online-alinanlar-listesi").innerHTML = html;
}
function sayfaAc(sayfaNo) {
    // Yeni kuran.html sayfasÄ±na yÃ¶nlendir, sayfa parametresi ile
    window.location.href = `kuran.html?sayfa=${sayfaNo}`;
}
	// --- HATÄ°M UYARI SÄ°STEMÄ° ---

function hatimUyariKontrol() {
    // 1. KullanÄ±cÄ± daha Ã¶nce "GÃ¶sterme" demiÅŸ mi?
    let gosterme = localStorage.getItem("hatim_uyari_gosterme");
    
    // EÄŸer "true" kayÄ±tlÄ±ysa fonksiyonu durdur, modalÄ± aÃ§ma
    if (gosterme === "true") return;

    // 2. KayÄ±t yoksa ModalÄ± AÃ§
    let modal = document.getElementById("modal-hatim-uyari");
    if(modal) modal.style.display = "flex";
}

function kapatHatimUyari() {
    // Checkbox iÅŸaretli mi kontrol et
    let chk = document.getElementById("chk-hatim-uyari-kalici");
    
    if (chk && chk.checked) {
        // Ä°ÅŸaretliyse hafÄ±zaya kaydet
        localStorage.setItem("hatim_uyari_gosterme", "true");
    }

    // ModalÄ± kapat
    document.getElementById("modal-hatim-uyari").style.display = "none";
}
	// --- ARÅÄ°V SÄ°STEMÄ° FONKSÄ°YONLARI ---

// 1. OTOMATÄ°K TEMÄ°ZLEME (Hatim deÄŸiÅŸince Ã§alÄ±ÅŸÄ±r)
function otomatikGecmisHatimleriTemizle(guncelSunucuHatimNo) {
    let aktifList = JSON.parse(localStorage.getItem("online_sayfalarim") || "[]");
    let arsiv = JSON.parse(localStorage.getItem("hatim_arsivi") || "[]");
    let degisiklikVar = false;
    let yeniAktifList = [];

    aktifList.forEach(item => {
        // EÄŸer sayfanÄ±n hatim numarasÄ± var VE sunucudaki gÃ¼ncel hatimden kÃ¼Ã§Ã¼kse -> ArÅŸive at
        if (item.hatimNo && item.hatimNo < guncelSunucuHatimNo) {
            arsiv.push(item);
            degisiklikVar = true;
        } else {
            // DeÄŸilse aktif listede kalsÄ±n
            yeniAktifList.push(item);
        }
    });

    if (degisiklikVar) {
        localStorage.setItem("online_sayfalarim", JSON.stringify(yeniAktifList));
        localStorage.setItem("hatim_arsivi", JSON.stringify(arsiv));
        // KullanÄ±cÄ±ya haber verelim (Opsiyonel, istersen silebilirsin)
        showUpdateBar(); // Veya console.log("Eski hatimler arÅŸivlendi.");
    }
}

// 2. MANUEL ARÅÄ°VLEME (KullanÄ±cÄ± butona basarsa)
function manuelArsivle(index, hNo, sayfaNo) {
    if(!confirm("Sayfa " + sayfaNo + " arÅŸive taÅŸÄ±nacak. OnaylÄ±yor musunuz?")) return;

    let aktifList = JSON.parse(localStorage.getItem("online_sayfalarim") || "[]");
    let arsiv = JSON.parse(localStorage.getItem("hatim_arsivi") || "[]");
    
    // Veriyi al
    let tasinacakVeri = aktifList[index];
    
    // EÄŸer veride hatim no yoksa (eski veriyse) ekrandan tahmin etmeye Ã§alÄ±ÅŸ veya 'Genel' yap
    if(!tasinacakVeri.hatimNo) {
        tasinacakVeri.hatimNo = hNo !== 'Eski' ? hNo : "GeÃ§miÅŸ";
    }

    // ArÅŸive ekle
    arsiv.push(tasinacakVeri);
    
    // Listeden sil
    aktifList.splice(index, 1);

    // Kaydet
    localStorage.setItem("hatim_arsivi", JSON.stringify(arsiv));
    localStorage.setItem("online_sayfalarim", JSON.stringify(aktifList));

    // EkranÄ± Yenile
    alinanlariListele();
    arsivRenderEt();
}

// 3. ARÅÄ°VÄ° GÃ–STER / GÄ°ZLE
function arsivAcKapat() {
    let alan = document.getElementById("arsiv-alani");
    let ok = document.getElementById("arsiv-ok-ikonu");
    
    if (alan.style.display === "block") {
        alan.style.display = "none";
        ok.className = "fa fa-chevron-down";
    } else {
        alan.style.display = "block";
        ok.className = "fa fa-chevron-up";
        arsivRenderEt();
    }
}

// 4. ARÅÄ°VÄ° EKRANA BAS (Gruplu Åekilde)
function arsivRenderEt() {
    let arsiv = JSON.parse(localStorage.getItem("hatim_arsivi") || "[]");
    let container = document.getElementById("arsiv-alani");
    
    if (arsiv.length === 0) {
        container.innerHTML = "<div style='text-align:center; color:#999; font-size:0.8rem; padding:10px;'>ArÅŸiv boÅŸ.</div>";
        return;
    }

    // Gruplama
    let gruplar = {};
    arsiv.forEach(item => {
        let key = item.hatimNo || "DiÄŸer"; // Hatim No yoksa 'DiÄŸer' grubuna at
        if (!gruplar[key]) gruplar[key] = [];
        gruplar[key].push(item.sayfa);
    });

    let html = "";
    // Hatim numaralarÄ±na gÃ¶re (BÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe) sÄ±rala
    Object.keys(gruplar).sort((a, b) => b - a).forEach(hatimNo => {
        let baslik = isNaN(hatimNo) ? hatimNo : hatimNo + ". Hatim";
        
        // SayfalarÄ± kÃ¼Ã§Ã¼kten bÃ¼yÃ¼ÄŸe sÄ±rala
        let sayfalar = gruplar[hatimNo].sort((a, b) => a - b);
        
        html += `<div class="arsiv-baslik">${baslik}</div><div>`;
        sayfalar.forEach(s => {
            html += `<span class="arsiv-sayfa-kutusu">${s}</span>`;
        });
        html += `</div>`;
    });

    container.innerHTML = html;
}
// Ã–zel Alert Fonksiyonu
function ozelAlert(mesaj, baslik = "Bilgi") {
    document.getElementById("custom-alert-msg").innerText = mesaj;
    document.getElementById("custom-alert-title").innerText = baslik;
    
    // Ä°konu baÅŸlÄ±ÄŸa gÃ¶re deÄŸiÅŸtirebiliriz (Opsiyonel)
    let ikon = "â„¹ï¸";
    if(baslik.includes("Hata") || baslik.includes("UyarÄ±")) ikon = "âš ï¸";
    if(baslik.includes("BaÅŸarÄ±lÄ±") || baslik.includes("Tamam")) ikon = "âœ…";
    
    document.querySelector(".modal-ikon").innerText = ikon;
    
    // Pencereyi GÃ¶ster
    document.getElementById("custom-alert").style.display = "flex";
}

function kapatAlert() {
    document.getElementById("custom-alert").style.display = "none";
}
</script>
<div id="custom-alert" class="modal-overlay" style="display: none;">
    <div class="modal-kutu">
        <div class="modal-ikon">âš ï¸</div>
        <h3 id="custom-alert-title">UyarÄ±</h3>
        <p id="custom-alert-msg">Mesaj buraya gelecek...</p>
        <button onclick="kapatAlert()" class="modal-btn">TAMAM</button>
    </div>
</div>
<div id="modal-sayfa-al" class="modal-overlay" style="display: none;">
    <div class="modal-kutu">
        <div class="modal-ikon">ğŸ“–</div>
        <h3>Sayfa Talep Et</h3>
        <p>Okumak istediÄŸiniz sayfa adedini giriniz:</p>
        
        <input type="number" id="inp-sayfa-adet" value="1" min="1" max="20" 
               style="width: 80%; padding: 10px; font-size: 1.2rem; text-align: center; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 20px; outline: none;">
        
        <div style="display: flex; gap: 10px;">
            <button onclick="kapatSayfaModal()" class="modal-btn" style="background:#888;">Ä°ptal</button>
            <button onclick="onaylaSayfaAl()" class="modal-btn">Tamam</button>
        </div>
    </div>
</div>
</body>
</html>
